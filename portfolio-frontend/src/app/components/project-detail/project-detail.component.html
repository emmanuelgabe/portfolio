<div class="container py-5">
  <!-- Back Button -->
  <div class="row mb-4">
    <div class="col">
      <button class="btn btn-outline-secondary" (click)="goBack()">
        <i class="bi bi-arrow-left me-2"></i>
         Retour aux projets
      </button>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
      <span class="visually-hidden">Chargement...</span>
    </div>
    <p class="mt-3 text-muted">Chargement des détails du projet...</p>
  </div>

  <!-- Error Alert -->
  <div *ngIf="error" class="alert alert-danger" role="alert">
    <i class="bi bi-exclamation-triangle-fill me-2"></i>
    <strong>Erreur !</strong> {{ error }}
    <div class="mt-3">
      <button class="btn btn-outline-danger btn-sm me-2" (click)="retry()">
        <i class="bi bi-arrow-clockwise me-1"></i>
        Réessayer
      </button>
      <button class="btn btn-outline-secondary btn-sm" (click)="goBack()">
        <i class="bi bi-arrow-left me-1"></i>
        Retour aux projets
      </button>
    </div>
  </div>

  <!-- Project Details -->
  <div *ngIf="!isLoading && !error && project" class="project-detail">
    <!-- Project Header -->
    <div class="row mb-4">
      <div class="col">
        <div class="d-flex justify-content-between align-items-start">
          <div>
            <h1 class="display-4 mb-3">{{ project.title }}</h1>
            <div class="badges mb-3">
              <span
                *ngFor="let tag of project.tags"
                class="badge rounded-pill me-2 mb-2"
                [style.background-color]="tag.color || '#6c757d'"
              >
                {{ tag.name }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Project Images Carousel -->
    <div class="row mb-4" *ngIf="hasMultipleImages">
      <div class="col">
        <div class="carousel slide project-carousel position-relative">
          <!-- Indicators -->
          <div class="carousel-indicators" *ngIf="sortedImages.length > 1">
            <button
              *ngFor="let image of sortedImages; let i = index"
              type="button"
              [class.active]="i === currentSlideIndex"
              [attr.aria-current]="i === currentSlideIndex ? 'true' : null"
              (click)="goToSlide(i)"
            ></button>
          </div>

          <!-- Slides -->
          <div class="carousel-inner rounded shadow">
            <div
              *ngFor="let image of sortedImages; let i = index"
              class="carousel-item"
              [class.active]="i === currentSlideIndex"
            >
              <img
                [src]="getFullImageUrl(image.imageUrl)"
                [alt]="image.altText || project.title"
                class="d-block w-100 carousel-image"
              />
              <div class="carousel-caption d-none d-md-block" *ngIf="image.caption">
                <p class="mb-0">{{ image.caption }}</p>
              </div>
            </div>
          </div>

          <!-- Controls -->
          <button
            *ngIf="sortedImages.length > 1"
            class="carousel-control-prev"
            type="button"
            (click)="prevSlide()"
          >
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Precedent</span>
          </button>
          <button
            *ngIf="sortedImages.length > 1"
            class="carousel-control-next"
            type="button"
            (click)="nextSlide()"
          >
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Suivant</span>
          </button>
        </div>

        <!-- Thumbnail Navigation -->
        <div class="thumbnail-nav mt-3 d-flex justify-content-center gap-2" *ngIf="sortedImages.length > 1">
          <button
            *ngFor="let image of sortedImages; let i = index"
            type="button"
            class="btn p-0 border-0 thumbnail-btn"
            [class.active]="i === currentSlideIndex"
            (click)="goToSlide(i)"
          >
            <img
              [src]="getFullImageUrl(image.thumbnailUrl)"
              [alt]="'Miniature ' + (i + 1)"
              class="thumbnail-img rounded"
              [class.active]="i === currentSlideIndex"
            />
          </button>
        </div>
      </div>
    </div>

    <!-- Legacy Single Image (fallback) -->
    <div class="row mb-4" *ngIf="hasLegacyImage">
      <div class="col">
        <div class="project-image-container">
          <img
            [src]="legacyImageSrc"
            [alt]="project.title"
            class="img-fluid rounded shadow"
          />
        </div>
      </div>
    </div>

    <!-- Project Info Cards -->
    <div class="row mb-4">
      <!-- Description Card -->
      <div class="col-lg-8 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">
              <i class="bi bi-file-text me-2 text-primary"></i>
              Description
            </h5>
            <p class="card-text">{{ project.description }}</p>
          </div>
        </div>
      </div>

      <!-- Tech Stack Card -->
      <div class="col-lg-4 mb-4">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h5 class="card-title">
              <i class="bi bi-stack me-2 text-primary"></i>
              Technologies
            </h5>
            <ul class="list-unstyled tech-stack-list">
              <li *ngFor="let tech of techStackArray" class="mb-2">
                <i class="bi bi-check-circle-fill text-success me-2"></i>
                {{ tech }}
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="row mb-4" *ngIf="hasLinks">
      <div class="col">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="card-title mb-3">
              <i class="bi bi-link-45deg me-2 text-primary"></i>
              Liens
            </h5>
            <div class="d-flex flex-wrap gap-2">
              <a
                *ngIf="project.githubUrl && project.githubUrl.trim() !== ''"
                [href]="project.githubUrl"
                target="_blank"
                rel="noopener noreferrer"
                class="btn btn-dark"
              >
                <i class="bi bi-github me-2"></i>
                Voir sur GitHub
              </a>
              <!-- Internal route (starts with /) -->
              <a
                *ngIf="project.demoUrl && project.demoUrl.trim() !== '' && isInternalRoute(project.demoUrl)"
                [routerLink]="project.demoUrl"
                class="btn btn-success"
              >
                <i class="bi bi-box-arrow-up-right me-2"></i>
                Démo en ligne
              </a>
              <!-- External URL -->
              <a
                *ngIf="project.demoUrl && project.demoUrl.trim() !== '' && !isInternalRoute(project.demoUrl)"
                [href]="project.demoUrl"
                target="_blank"
                rel="noopener noreferrer"
                class="btn btn-success"
              >
                <i class="bi bi-box-arrow-up-right me-2"></i>
                Démo en ligne
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
