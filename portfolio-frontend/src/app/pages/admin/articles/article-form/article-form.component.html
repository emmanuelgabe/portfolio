<div class="article-form">
  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>{{ (isEditMode ? 'admin.articles.edit' : 'admin.articles.new') | translate }}</h1>
    <button type="button" class="btn btn-outline-secondary" (click)="goBack()">
      <i class="bi bi-x-circle me-2"></i>
      {{ 'admin.common.cancel' | translate }}
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">{{ 'admin.common.loading' | translate }}</span>
    </div>
    <p class="mt-3 text-muted">{{ 'admin.articles.loadingArticle' | translate }}</p>
  </div>

  <!-- Form -->
  <div *ngIf="!loading">
    <form [formGroup]="articleForm" (ngSubmit)="saveDraft()">
      <div class="card shadow-sm mb-4">
        <div class="card-body">
          <!-- Title -->
          <div class="mb-3">
            <label for="title" class="form-label">
              {{ 'admin.articles.titleField' | translate }} <span class="text-danger">*</span>
            </label>
            <input
              type="text"
              class="form-control"
              id="title"
              formControlName="title"
              [readonly]="demoModeService.isDemo()"
              [placeholder]="'admin.articles.titlePlaceholder' | translate"
              [class.is-invalid]="articleForm.get('title')?.invalid && articleForm.get('title')?.touched"
            />
            <div class="invalid-feedback" *ngIf="articleForm.get('title')?.invalid && articleForm.get('title')?.touched">
              <div *ngIf="articleForm.get('title')?.errors?.['required']">
                {{ 'admin.articles.titleRequired' | translate }}
              </div>
              <div *ngIf="articleForm.get('title')?.errors?.['maxlength']">
                {{ 'admin.articles.titleMaxLength' | translate }}
              </div>
            </div>
            <small class="text-muted">
              {{ articleForm.get('title')?.value?.length || 0 }} / 200 {{ 'admin.common.characters' | translate }}
            </small>
          </div>

          <!-- Excerpt -->
          <div class="mb-3">
            <label for="excerpt" class="form-label">
              {{ 'admin.articles.excerpt' | translate }}
            </label>
            <textarea
              class="form-control"
              id="excerpt"
              formControlName="excerpt"
              rows="2"
              [readonly]="demoModeService.isDemo()"
              [placeholder]="'admin.articles.excerptPlaceholder' | translate"
              [class.is-invalid]="articleForm.get('excerpt')?.invalid && articleForm.get('excerpt')?.touched"
            ></textarea>
            <div class="invalid-feedback" *ngIf="articleForm.get('excerpt')?.invalid && articleForm.get('excerpt')?.touched">
              <div *ngIf="articleForm.get('excerpt')?.errors?.['maxlength']">
                {{ 'admin.articles.excerptMaxLength' | translate }}
              </div>
            </div>
            <small class="text-muted">
              {{ articleForm.get('excerpt')?.value?.length || 0 }} / 500 {{ 'admin.common.characters' | translate }}
            </small>
          </div>

          <!-- Tags -->
          <div class="mb-3">
            <label class="form-label">{{ 'admin.articles.tags' | translate }}</label>
            <div class="tags-container">
              <button
                *ngFor="let tag of availableTags"
                type="button"
                class="btn btn-sm me-2 mb-2"
                [class.btn-primary]="isTagSelected(tag.id)"
                [class.btn-outline-secondary]="!isTagSelected(tag.id)"
                [disabled]="demoModeService.isDemo()"
                [style.opacity]="demoModeService.isDemo() ? '0.65' : '1'"
                [title]="demoModeService.isDemo() ? ('admin.common.demoModeDisabled' | translate) : ''"
                (click)="toggleTag(tag.id)"
              >
                {{ tag.name }}
              </button>
            </div>
            <small class="text-muted" *ngIf="availableTags.length === 0">
              {{ 'admin.articles.noTags' | translate }}
            </small>
          </div>

          <!-- Content (EasyMDE) -->
          <div class="mb-3">
            <label for="content-editor" class="form-label">
              {{ 'admin.articles.content' | translate }} <span class="text-danger">*</span>
            </label>
            <div *ngIf="!isEditMode" class="alert alert-info mb-2">
              <i class="bi bi-info-circle me-2"></i>
              {{ 'admin.articles.saveBeforeImages' | translate }}
            </div>
            <div *ngIf="uploadingImage" class="alert alert-primary mb-2">
              <div class="spinner-border spinner-border-sm me-2" role="status">
                <span class="visually-hidden">{{ 'admin.common.uploading' | translate }}</span>
              </div>
              {{ 'admin.articles.uploadingImage' | translate }}
            </div>
            <textarea
              id="content-editor"
              formControlName="content"
              style="display: none;"
            ></textarea>
            <div class="invalid-feedback d-block" *ngIf="articleForm.get('content')?.invalid && articleForm.get('content')?.touched">
              <div *ngIf="articleForm.get('content')?.errors?.['required']">
                {{ 'admin.articles.contentRequired' | translate }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="d-flex justify-content-between">
        <button type="button" class="btn btn-outline-secondary" (click)="goBack()">
          <i class="bi bi-x-circle me-2"></i>
          {{ 'admin.common.cancel' | translate }}
        </button>

        <div class="btn-group" role="group">
          <button
            type="submit"
            class="btn btn-outline-primary"
            [disabled]="submitting || articleForm.invalid || demoModeService.isDemo()"
            [style.opacity]="demoModeService.isDemo() ? '0.65' : '1'"
            [title]="demoModeService.isDemo() ? ('admin.common.demoModeDisabled' | translate) : ''"
          >
            <span *ngIf="!submitting">
              <i class="bi bi-save me-2"></i>
              {{ 'admin.articles.saveDraft' | translate }}
            </span>
            <span *ngIf="submitting">
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              {{ 'admin.articles.saving' | translate }}
            </span>
          </button>

          <button
            type="button"
            class="btn btn-success"
            (click)="saveAndPublish()"
            [disabled]="submitting || articleForm.invalid || demoModeService.isDemo()"
            [style.opacity]="demoModeService.isDemo() ? '0.65' : '1'"
            [title]="demoModeService.isDemo() ? ('admin.common.demoModeDisabled' | translate) : ''"
          >
            <span *ngIf="!submitting">
              <i class="bi bi-upload me-2"></i>
              {{ (isEditMode ? 'admin.articles.updateAndPublish' : 'admin.articles.createAndPublish') | translate }}
            </span>
            <span *ngIf="submitting">
              <span class="spinner-border spinner-border-sm me-2" role="status"></span>
              {{ 'admin.articles.publishing' | translate }}
            </span>
          </button>
        </div>
      </div>
    </form>
  </div>
</div>
